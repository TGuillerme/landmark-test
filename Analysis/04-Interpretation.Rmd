---
title: "Landmark region difference"
author: "Thomas Guillerme"
bibliography: references.bib
date: "`r Sys.Date()`"
output:
  html_document:
    fig_width: 12
    fig_height: 6
---

```{r, message = FALSE, warning = FALSE}
if(!require(knitr)) install.packages("knitr")
source("../Functions/utilities.R")
```

## Results summary


The values for each species (or the genus) are the difference in area under the curve of landmarks variation length.
When this value is positive, the partition contains longer landmark variation compared to all the other landmarks, when negative, it contains shorter variation.
`diff` and `over` are the significance results from the random test for respectively the are difference (the value displayed) and the probability of overlap.
`*` signifies a p-value below 0.01, `.` a p-value between 0.01 and 0.05 and no token for a p-value > 0.05.
I am using a lower acceptance threshold for the p-values due to the amount of bootstrap replicates (1000) that inflate the type I error.

If a result is significant for one test but not the other, the partition should be considered as **not** different.
For example, if the distribution of landmarks within a partition does significantly not overlap with the distribution of all the landmarks (`over = *`) but these landmarks are not significantly longer or shorter than the other ones (`diff` has no token), we can not confidently say the partition is significantly different.
The same argument goes if the difference is significant (`diff = *`) but not the probability of not overlapping (`over`).

These results are not rarefied (i.e. I haven't had time to check the effect of the different number of landmarks in different partitions yet).


```{r, echo = FALSE}
get.token <- function(p) {
    if(p > 0.05) {
        return("")
    }
    if(p < 0.05 && p > 0.01) {
        return(".")
    }
    if(p < 0.01 && p > 0.001) {
        return("*")
    }
    if(p < 0.001) {
        return("**")
    }
}

species <- c("Wombat", "Wombat_krefftii", "Wombat_latifrons", "Wombat_ursinus")
datasets <- c("cranium", "mandible")

results_table <- data.frame(matrix(NA, ncol = length(species)*3, nrow = 11))

for(sp in 1:length(species)) {

    for(ds in 1:length(datasets)) {

        ## Extract the results
        load(paste0("../Data/Results/", species[sp], "_", datasets[ds], ".Rda"))

        ## Summarise the results
        difference <- make.table(results$difference, correction = "bonferroni")
        overlap <- make.table(results$overlaps, correction = "bonferroni")

        ## Fill the table
        if(ds == 1) {
            ## Cranium
            results_table[1:5, 1+(3*(sp-1))] <- difference[,2]
            results_table[1:5, 2+(3*(sp-1))] <- sapply(difference[,6], get.token)
            results_table[1:5, 3+(3*(sp-1))] <- sapply(overlap[,6], get.token)
            ## Make the differences to be 0 if non-signif
        } else {
            ## Mandible
            results_table[6:11, 1+(3*(sp-1))] <- difference[,2]
            results_table[6:11, 2+(3*(sp-1))] <- sapply(difference[,6], get.token)
            results_table[6:11, 3+(3*(sp-1))] <- sapply(overlap[,6], get.token)
        }
    }
}

## Colnames sequence
sequence <- seq(from = 1, to =11, by = 3)

## Renaming the columns
colnames(results_table)[sequence] <- species
colnames(results_table)[sequence+1] <- "diff"
colnames(results_table)[sequence+2] <- "over"

## Renaming the rows
rownames(results_table) <- c(paste0(datasets[1], 1:5), paste0(datasets[2], 1:6))


##
kable(results_table, digits = 4)

```

The only result that is consistent across all species and the genus is that the cranial partition 5 contains always smaller landmark variation.
It's interesting to see that this variation is smaller within species (between -0.10 and -0.27) but is bigger within the genus (-0.54).

Interestingly enough, two other partitions (`cranium2` and `mandible3`) have landmarks that are consistently different than the other ones but weirdly enough, the direction in which they change is not consistent between the species.
In `cranium2`, the landmarks variation is always bigger apart for _Wombat ursinus_ (smaller).
In `mandible3`, the landmarks variation is always smaller apart for _Wombat latifrons_ (bigger).

