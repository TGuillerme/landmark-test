---
  title: "Extracting landmark curves and patches; processing into 3D surfslide and curvslides"
author: "Vera Weisbecker"
date: "`r Sys.Date()`"
output:
  html_document:
  fig_width: 12
fig_height: 6
---

```{r}
library(stringr)
library(geomorph)

```
# Load data. These need to be raw data so I can pull out the landmark names
```{r}
  ## Create vectors of patch points, semi-landmarks, and landmarks
  # LM point name metadata
  


rawdata_cranium_wombat<-read.csv ("../Data/Raw/landmarkdata_cranium_wombat.csv")

pt_names <-rawdata_cranium_wombat[, 1] # grabs first column of raw coords
foo2 <- str_sub(pt_names, 3, -1) # gets rid of X, Y, Z designations
u_pt_names <- unique(foo2)

patches <- str_detect(u_pt_names, "patch") # check to see what Cruise called these points
pat_num <- which(patches == TRUE)

sliders <- str_detect(u_pt_names, "CUR")
sli_num <- which(sliders == TRUE)

LM <- !(sliders | patches)
LM_num <- which(LM == TRUE)

#Assign each landmark the appropriate number; Fixed is 1, semis are 2, patches are 3

#you need a 2-column matrix with column 1 the landmark number and column 2 available for filling (I am using a file that has some numbers already)
landmarkgroups=read.csv("../Data/Raw/landmarkgroups_cranium_wombat.csv")

landmark_LM_types<-landmark_LM_types
for (i in 1:length(landmark_LM_types[,1])){
if(landmark_LM_types[i,1] %in% pat_num ==TRUE)
landmark_LM_types[i,2]<-3

else
  
if(landmark_LM_types[i,1] %in% sli_num ==TRUE)
landmark_LM_types[i,2]<-2 

else
  
if(landmark_LM_types[i,1] %in% LM_num ==TRUE)
landmark_LM_types[i,2]<-1   

}


``` 
  

###visualize curves

```{r}

# Transpose rows and columns because of the format that Viewbox exports in
WomCrData <- t(rawdata_cranium_wombat) 
# Remove any empty rows
WomCrData <- WomCrData[complete.cases(WomCrData),] 
# Make 3D Array
WomCrData <- arrayspecs(WomCrData, k=3, p=ncol(WomCrData)/3) 

WomCrRef <- WomCrData[,,5]




PartLevels= unique(landmark_LM_types[,2])
Colours<-rainbow(length(PartLevels))
Colours <- c("blue", "orange")

Part=list()
#Subsetting the partition levels
for(i in 1:length(PartLevels)){
  Part[[i]]<-which (landmark_LM_types[,2] == PartLevels[[i]])
} 

#plotting the spheres- if you get only white, increase the radius!!       
open3d()
for (i in 1:length(PartLevels)){
  spheres3d(WomCrRef[Part[[i]],1], WomCrRef[Part[[i]],2], WomCrRef[Part[[i]],3], col=Colours[i], lit=TRUE,radius = 1, asp=F)
  
}

```
