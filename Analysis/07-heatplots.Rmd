---
title: "Heat map plot of changes"
author: "Thomas Guillerme"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_width: 12
    fig_height: 6
---

Some fancy plots for the maximum landmark variation.

## Plots 

### Loading the functions

```{r, message = FALSE, warning = FALSE}
## Loading the libraries (and installing if necessary)
if(!require(devtools)) install.packages("devtools")
if(!require(geomorph)) install.packages("geomorph")
if(!require(dispRity)) install_github("TGuillerme/dispRity")
if(!require(landmarktest)) install_github("TGuillerme/landmark-test")
set.seed(1)
```


### Loading the data

```{r}
## Loading a dataset

#loading the below loads objects called land_data, NOT "wombat"
load("../Data/Processed/wombat.Rda")
AllWombats<-land_data
load("../Data/Processed/wombat_krefftii.Rda")
NHNW<-land_data
load("../Data/Processed/wombat_latifrons.Rda")
SHNW<-land_data
load("../Data/Processed/wombat_ursinus.Rda")
CW<-land_data
source("../Functions/utilities.R")

```

The "maximum" and "minimum" specimen:

```{r}
## Procrustes variation ranges
cranium=SHNW$cranium
variation <- variation.range(cranium$procrustes, return.ID = TRUE, CI = 0.5)
specimens_min_max <- variation$min.max
procrustes_var <- variation$range[,1]
```

```{r, eval = FALSE}
gridPar = gridPar(pt.bg = "white", pt.size = 0.5)
open3d()
plotRefToTarget.heat(cranium$procruste$coords[, , specimens_min_max[2]],
                     cranium$procruste$coords[, , specimens_min_max[1]],
                     col = heat.colors, pt.size = 0.3, col.val = procrustes_var,
                     plotRefToTarget.args = list(mag = 1))
```


#Contrasting specimens on opposite PC axes

```{r}
## Procrustes variation ranges



variation_all_PC_axis <- variation.range(cranium$procrustes, return.ID = TRUE, ordination = TRUE, axis = 1)
#This does not work
specimens_min_max <- variation_all_PC_axis$min.max
procrustes_var <- variation_all_PC_axis$range[,1]
```

```{r, eval = FALSE}
gridPar = gridPar(pt.bg = "white", pt.size = 0.5)
open3d()
plotRefToTarget.heat(cranium$procruste$coords[, , specimens_min_max[2]],
                     cranium$procruste$coords[, , specimens_min_max[1]],
                     col = heat.colors, pt.size = 1, col.val = procrustes_var,
                     plotRefToTarget.args = list(mag = 1))
```


#Trying to do this using hypothetical PC min/max landmarks 

```{r, eval = FALSE}

#@params procrustes_coords is coordinate data (e.g.CW$cranium$procrustes$coords ); I'd like to add a "required_PC" which is the PC number we want to look at but don't know how that works

## Procrustes variation ranges
variation <- variation.range(cranium$procrustes, return.ID = TRUE, CI = 0.5)
#this identifies specimens at opposite ends of the PC spectrum - not what I am after
specimens_min_max <- variation$min.max
#the below needs to be the variation range for hypothetical PC1 vs hypothetical PC2
procrustes_var <- variation$range[,1]



heatplot_PCs<-function (Procrustes_coords){

PCA=plotTangentSpace(Procrustes_coords)
  
gridPar = gridPar(pt.bg = "white", pt.size = 0.5)
open3d()
plotRefToTarget.heat(PCA$pc.shapes$PC1min,
                     PCA$pc.shapes$PC1max,
                     col = heat.colors, pt.size = 0.7, col.val = procrustes_var,
                     plotRefToTarget.args = list(mag = 1))
}

heatplot_PCs(CW$cranium$procrustes$coords)
heatplot_PCs(SHNW$cranium$procrustes$coords)
heatplot_PCs(NHNW$cranium$procrustes$coords)

heatplot_PCs(CW$mandible$procrustes$coords)
heatplot_PCs(SHNW$mandible$procrustes$coords)
heatplot_PCs(NHNW$mandible$procrustes$coords)

```

