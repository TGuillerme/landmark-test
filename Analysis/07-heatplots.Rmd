---
title: "Heat map plot of changes"
author: "Thomas Guillerme"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_width: 12
    fig_height: 6
---

Some fancy plots for the maximum landmark variation.

## Plots 

### Loading the functions

```{r, message = FALSE, warning = FALSE}
## Loading the libraries (and installing if necessary)
if(!require(devtools)) install.packages("devtools"); library(devtools)
if(!require(geomorph)) install.packages("geomorph"); library(geomorph)
if(!require(dispRity)) install.packages("dispRity"); library(dispRity)
if(!require(landvR)) install_github("TGuillerme/landvR") ; library(landvR)
set.seed(42)
```


### Loading the data

```{r}
## Loading a dataset

#loading the below loads objects called land_data, NOT "wombat"
load("../Data/Processed/wombat.Rda")
AllWombats<-land_data
load("../Data/Processed/wombat_lasiorhinus.Rda")
HN<-land_data
load("../Data/Processed/wombat_krefftii.Rda")
NHNW<-land_data
load("../Data/Processed/wombat_latifrons.Rda")
SHNW<-land_data
load("../Data/Processed/wombat_ursinus.Rda")
CW<-land_data
source("../Functions/utilities.R")

```

The "maximum" and "minimum" specimen in procrustes space

```{r}
## Procrustes variation ranges
cranium=SHNW$cranium
variation <- variation.range(cranium$procrustes, return.ID = TRUE)
specimens_min_max <- variation$min.max
procrustes_var <- variation$range[,1]
```

```{r, eval = FALSE}
gridPar = gridPar(pt.bg = "white", pt.size = 0.5)
open3d()
procrustes.var.plot(cranium$procrustes$coords[, , specimens_min_max[2]],
                     cranium$procrustes$coords[, , specimens_min_max[1]],
                     col = heat.colors, pt.size = 0.8, col.val = procrustes_var)
```

Specimens along PC extremes (i.e. not hypothetical specimens, as per warning messaage)
```{r}

##  variation ranges
cranium=CW$cranium
variation <- variation.range(cranium$procrustes, return.ID = TRUE, axis=1, ordination=cranium$ordination )

specimens_min_max <- variation$min.max
procrustes_var <- variation$range[,1]
```

```{r, eval = FALSE}
gridPar = gridPar(pt.bg = "white", pt.size = 0.5)
open3d()
procrustes.var.plot(cranium$procrustes$coords[, , specimens_min_max[2]],
                     cranium$procrustes$coords[, , specimens_min_max[1]],
                     col = heat.colors, pt.size = 0.8, col.val = procrustes_var)
```


```

#Doing this using hypothetical PC min/max landmarks for the figures in the manuscript. See utilities file for details. Also be aware that the warning message that the returned specimen does not correspond to the PCmin/max specimen but the nearest observed one is INCORRECT in this case becasue we are using the hypothetical configurations as specimens.

```{r, eval = FALSE}
## Craniums
## All wombats
heatplot.PCs(AllWombats$cranium, minfirst=FALSE, 1 )
## Lasiorhinus
heatplot.PCs(HN$cranium, minfirst=TRUE ,1 )
## Vombatus
heatplot.PCs(CW$cranium, minfirst=FALSE,1)
## Lasihorhinus latifrons
heatplot.PCs(SHNW$cranium, minfirst=TRUE,1)
## Lasihorhinus krefftii
heatplot.PCs(NHNW$cranium, minfirst=TRUE,1)

## Mandibles
## All wombats
heatplot.PCs(AllWombats$mandible, minfirst=FALSE, 1)
## Lasihorhinus
heatplot.PCs(HN$mandible, minfirst=TRUE, 1 )
## Vombatus
heatplot.PCs(CW$mandible, minfirst=FALSE,1)
## Lasihorhinus latifrons
heatplot.PCs(SHNW$mandible, minfirst=TRUE,1)
## Lasihorhinus krefftii
heatplot.PCs(NHNW$mandible, minfirst=TRUE, 1)
```

